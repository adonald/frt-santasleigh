<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Santa Sleigh Tracker</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family:
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI",
        Roboto,
        Helvetica,
        Arial,
        "Helvetica Neue",
        sans-serif;
      background: #001;
      color: white;
    }

    body { height: 100vh; overflow: hidden; }
    #map { height: 100vh; width: 100vw; }

    .status-popup {
      position: absolute;
      top: 24px; left: 50%; transform: translateX(-50%);
      background: rgba(24,24,24,0.93);
      color: #fff;
      padding: 16px 18px 12px 18px;
      font-size: 1.25em;
      font-weight: 700;
      border-radius: 18px;
      box-shadow: 0 4px 32px #0006;
      z-index: 2000;
      text-align: center;
      min-width: 300px;
      max-width: 95vw;
      letter-spacing: 0.01em;
      line-height: 1.25;
    }

    .info-popup {
      position: fixed;
      left: 50%; transform: translateX(-50%);
      bottom: 16px;
      background: rgba(20,20,20,0.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 4px 28px #0006;
      z-index: 2000;
      display: inline-flex;
      gap: 12px; align-items: center; flex-wrap: wrap;
      font-size: 0.85em; font-weight: 700;
    }

    .info-popup .controls {
      display: inline-flex; gap: 12px; align-items: center; flex-wrap: nowrap; white-space: nowrap;
    }

    .muted { opacity: .9; font-weight: 600; display: none; }

    .btn {
      background:#0b1220;
      color:#fff;
      border:1px solid #ffffff26;
      border-radius: 10px;
      padding:6px 10px;
      font-size:.85em;
      font-weight:800;
      cursor:pointer;
    }

    .btn:disabled { opacity:.7; cursor:not-allowed; }

    /* ‚≠ê DONATE BUTTON ‚≠ê */
    .donate-box {
      position: fixed;
      bottom: 70px; /* desktop + landscape */
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      text-align: center;
    }

    .donate-btn {
      background: #d31c1c;
      color: #fff;
      font-weight: 800;
      padding: 12px 20px;
      border-radius: 14px;
      text-decoration: none;
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
      display: inline-block;
      font-size: 1.05em;
    }

    #snow { position: fixed; inset: 0; z-index: 1000; pointer-events: none; }

    /* üì± Mobile portrait ‚Äî dynamic spacing based on viewport height */
    @media (max-width: 600px) and (orientation: portrait) {

      .status-popup { font-size: 1em; padding: 12px 10px; min-width: 160px; }
      .info-popup { font-size: 0.8em; bottom: 10px; gap: 8px; }

      .donate-box {
        bottom: calc(12vh) !important; /* üìå dynamically perfect on all phones */
      }
    }

  </style>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body>

  <div class="status-popup" id="status-box">üéÑ Santa is currently in Lapland preparing for Christmas!</div>

  <!-- ‚≠ê DONATE BUTTON ‚≠ê -->
  <div class="donate-box">
    <a href="https://www.paypal.com/donate/?hosted_button_id=3Q68MXSF6R8E6" target="_blank" class="donate-btn">
      üéÅ DONATE!
    </a>
  </div>

  <div class="info-popup">
    <span class="muted" id="lastUpdated">Last update: ‚Äî</span>
    <span class="muted" id="age">Age: ‚Äî</span>

    <span class="controls">
      <button class="btn" id="followBtn" title="Keep the map centred on Santa">Follow Santa: ON</button>
      <button class="btn" id="recenterBtn" title="Re-centre on Santa">Re-centre</button>
    </span>
  </div>

  <canvas id="snow"></canvas>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    const central_date = new Date(2025, 12, 18);
    const chantrys_date = new Date(2025, 12, 16);
    const folly_hill_date = new Date(2025, 12, 9);
    const heath_end_date = new Date(2025, 12, 17);
    const rowledge_date = new Date(2025, 12, 11);
    const south_farnham_date = new Date(2025, 12, 10);
    const date_options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

    const firebaseURL = "https://frt-santas-sleigh-default-rtdb.europe-west1.firebasedatabase.app/location/current.json";

    const REFRESH_MS = 10000;
    const STALE_MS = 5 * 60000;
    const FETCH_TIMEOUT_MS = 7000;

    //const fallbackCoords = { lat: 66.5436, lng: 25.8473 }; //Lapland
    const fallbackCoords = { lat: 51.2149, lng: -0.7989 }; //Farnham
    
    const map = L.map("map").setView([fallbackCoords.lat, fallbackCoords.lng], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const sleighIcon = L.icon({
      iconUrl: "https://i.ibb.co/pvjck0Vg/santa-icon.png",
      iconSize: [32, 32],
      iconAnchor: [32, 32],
      popupAnchor: [0, -32]
    });

    const marker = L.marker([fallbackCoords.lat, fallbackCoords.lng], { icon: sleighIcon })
      .addTo(map)
      .bindPopup("Santa is here!");

    const trail = L.polyline([], { weight: 3, opacity: 0.9 }).addTo(map);

    const statusBox = document.getElementById("status-box");
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const ageEl = document.getElementById('age');
    const followBtn = document.getElementById('followBtn');
    const recenterBtn = document.getElementById('recenterBtn');

    const fmt = new Intl.DateTimeFormat('en-GB', {
      hour: '2-digit', minute: '2-digit', second: '2-digit',
      day: '2-digit', month: 'short', timeZone: 'Europe/London'
    });

    const central_latlngs = [
      [51.2233,-0.78396],
      [51.22308,-0.784],
      [51.22307,-0.78381],
      [51.22305,-0.78314],
      [51.22303,-0.78214],
      [51.22303,-0.78206],
      [51.22303,-0.78198],
      [51.22303,-0.78196],
      [51.22303,-0.78194],
      [51.22303,-0.7819],
      [51.22303,-0.78188],
      [51.22302,-0.78185],
      [51.22301,-0.78183],
      [51.22279,-0.78159],
      [51.22258,-0.78144],
      [51.22246,-0.78134],
      [51.22231,-0.78123],
      [51.2222,-0.78117],
      [51.22213,-0.78112],
      [51.22204,-0.78111],
      [51.22195,-0.7811],
      [51.22172,-0.78114],
      [51.2215,-0.78117],
      [51.22144,-0.78119],
      [51.22109,-0.78125],
      [51.221,-0.78127],
      [51.22072,-0.78129],
      [51.221,-0.78127],
      [51.22109,-0.78125],
      [51.22144,-0.78119],
      [51.2215,-0.78117],
      [51.22172,-0.78114],
      [51.22195,-0.7811],
      [51.22204,-0.78111],
      [51.22213,-0.78112],
      [51.2222,-0.78117],
      [51.22231,-0.78123],
      [51.22246,-0.78134],
      [51.22258,-0.78144],
      [51.22279,-0.78159],
      [51.22301,-0.78183],
      [51.22302,-0.78185],
      [51.22303,-0.78188],
      [51.22303,-0.7819],
      [51.22303,-0.78194],
      [51.22303,-0.78196],
      [51.22303,-0.78198],
      [51.22303,-0.78206],
      [51.22303,-0.78214],
      [51.22305,-0.78314],
      [51.22307,-0.78381],
      [51.22308,-0.784],
      [51.22276,-0.78409],
      [51.22256,-0.78418],
      [51.22225,-0.78432],
      [51.22204,-0.78443],
      [51.22193,-0.78451],
      [51.22189,-0.78426],
      [51.22188,-0.78423],
      [51.22188,-0.78421],
      [51.22187,-0.78418],
      [51.22184,-0.78413],
      [51.22182,-0.7841],
      [51.22161,-0.78388],
      [51.22169,-0.78362],
      [51.22177,-0.78337],
      [51.22181,-0.78326],
      [51.2215,-0.78297],
      [51.22137,-0.78284],
      [51.2215,-0.78297],
      [51.22181,-0.78326],
      [51.22177,-0.78337],
      [51.22169,-0.78362],
      [51.22161,-0.78388],
      [51.22141,-0.78368],
      [51.22122,-0.7835],
      [51.22106,-0.78336],
      [51.22086,-0.78317],
      [51.22071,-0.78304],
      [51.22052,-0.78285],
      [51.22048,-0.78284],
      [51.22045,-0.78284],
      [51.22042,-0.78286],
      [51.22039,-0.78261],
      [51.22039,-0.78254],
      [51.2204,-0.78246],
      [51.22043,-0.78237],
      [51.22048,-0.78227],
      [51.22043,-0.78237],
      [51.2204,-0.78246],
      [51.22039,-0.78254],
      [51.22039,-0.78261],
      [51.22042,-0.78286],
      [51.22038,-0.78288],
      [51.22036,-0.78288],
      [51.22035,-0.7829],
      [51.22032,-0.78295],
      [51.22021,-0.78314],
      [51.21985,-0.78279],
      [51.22021,-0.78314],
      [51.22013,-0.78333],
      [51.22003,-0.78356],
      [51.21995,-0.78373],
      [51.21991,-0.78381],
      [51.21965,-0.78357],
      [51.21991,-0.78381],
      [51.21995,-0.78373],
      [51.22003,-0.78356],
      [51.22013,-0.78333],
      [51.22021,-0.78314],
      [51.22032,-0.78295],
      [51.22035,-0.7829],
      [51.22036,-0.78288],
      [51.22038,-0.78288],
      [51.22042,-0.78286],
      [51.22045,-0.78284],
      [51.22048,-0.78284],
      [51.22052,-0.78285],
      [51.22071,-0.78304],
      [51.22086,-0.78317],
      [51.22106,-0.78336],
      [51.22122,-0.7835],
      [51.22141,-0.78368],
      [51.22161,-0.78388],
      [51.22182,-0.7841],
      [51.22184,-0.78413],
      [51.22187,-0.78418],
      [51.22188,-0.78421],
      [51.22188,-0.78423],
      [51.22189,-0.78426],
      [51.22193,-0.78451],
      [51.22157,-0.78472],
      [51.22114,-0.78503],
      [51.22107,-0.78508],
      [51.22089,-0.78521],
      [51.22075,-0.78537],
      [51.22054,-0.78577],
      [51.22042,-0.78603],
      [51.22036,-0.78618],
      [51.22012,-0.78674],
      [51.22011,-0.78674],
      [51.21986,-0.78716],
      [51.21972,-0.78739],
      [51.21928,-0.78822],
      [51.21916,-0.78855],
      [51.21903,-0.7889],
      [51.21933,-0.78911],
      [51.21948,-0.78921],
      [51.21999,-0.78958],
      [51.22027,-0.78978],
      [51.22032,-0.78981],
      [51.22024,-0.79007],
      [51.2202,-0.79021],
      [51.22005,-0.79056],
      [51.21998,-0.79071],
      [51.21972,-0.79153],
      [51.21965,-0.79153],
      [51.21961,-0.79155],
      [51.21957,-0.79157],
      [51.21954,-0.79159],
      [51.2195,-0.79161],
      [51.21949,-0.79163],
      [51.21948,-0.79164],
      [51.21946,-0.79167],
      [51.21944,-0.79173],
      [51.21945,-0.79184],
      [51.21946,-0.79194],
      [51.21947,-0.79202],
      [51.21949,-0.79207],
      [51.2195,-0.79212],
      [51.21952,-0.79215],
      [51.21954,-0.79218],
      [51.21959,-0.79219],
      [51.21965,-0.79266],
      [51.21966,-0.79276],
      [51.21966,-0.79277],
      [51.21966,-0.79296],
      [51.21965,-0.79301],
      [51.21965,-0.79306],
      [51.21965,-0.7931],
      [51.21964,-0.79313],
      [51.21962,-0.79318],
      [51.21955,-0.7934],
      [51.21938,-0.79383],
      [51.21925,-0.79417],
      [51.2191,-0.79457],
      [51.21889,-0.79438],
      [51.21888,-0.79437],
      [51.21874,-0.79427],
      [51.21851,-0.79412],
      [51.2184,-0.79444],
      [51.21833,-0.79462],
      [51.21828,-0.79476],
      [51.21824,-0.79487],
      [51.21802,-0.79546],
      [51.21792,-0.7954],
      [51.21787,-0.79537],
      [51.21782,-0.79535],
      [51.21775,-0.79533],
      [51.21771,-0.79532],
      [51.21765,-0.79532],
      [51.21757,-0.79533],
      [51.21751,-0.79535],
      [51.21746,-0.79549],
      [51.21741,-0.79566],
      [51.21739,-0.79571],
      [51.21739,-0.79572],
      [51.21739,-0.79582],
      [51.21739,-0.79607],
      [51.21738,-0.7965],
      [51.21737,-0.79662],
      [51.21736,-0.79667],
      [51.21734,-0.79676],
      [51.21729,-0.79691],
      [51.2171,-0.79743],
      [51.21709,-0.79746],
      [51.21707,-0.79748],
      [51.21705,-0.79748],
      [51.21703,-0.79747],
      [51.21681,-0.79727],
      [51.21673,-0.79736],
      [51.21667,-0.79746],
      [51.21662,-0.79747],
      [51.21667,-0.79746],
      [51.21673,-0.79736],
      [51.21681,-0.79727],
      [51.21703,-0.79747],
      [51.21705,-0.79748],
      [51.21707,-0.79748],
      [51.21709,-0.79746],
      [51.2171,-0.79743],
      [51.21729,-0.79691],
      [51.21734,-0.79676],
      [51.21736,-0.79667],
      [51.21737,-0.79662],
      [51.21738,-0.7965],
      [51.21739,-0.79607],
      [51.21739,-0.79582],
      [51.21739,-0.79572],
      [51.21739,-0.79571],
      [51.21741,-0.79566],
      [51.21756,-0.79581],
      [51.21772,-0.79595],
      [51.21808,-0.79628],
      [51.21789,-0.7967],
      [51.21787,-0.79675],
      [51.21775,-0.7971],
      [51.2177,-0.79725],
      [51.21761,-0.79758],
      [51.21745,-0.79804],
      [51.21735,-0.79825],
      [51.21731,-0.79835],
      [51.21724,-0.79849],
      [51.21715,-0.79871],
      [51.21714,-0.79872],
      [51.21703,-0.79901],
      [51.217,-0.7991],
      [51.21699,-0.79913],
      [51.21695,-0.79928],
      [51.21688,-0.79945],
      [51.21684,-0.79953],
      [51.21674,-0.79978],
      [51.21657,-0.80023],
    ];

    const chantrys_latlngs = [
      [51.21107,-0.80742],
      [51.21102,-0.80734],
      [51.2109,-0.80715],
      [51.21073,-0.80691],
      [51.21069,-0.80683],
      [51.21065,-0.80673],
      [51.21062,-0.80662],
      [51.21061,-0.80649],
      [51.21061,-0.8064],
      [51.21063,-0.80631],
      [51.21066,-0.80623],
      [51.21076,-0.80602],
      [51.21078,-0.80598],
      [51.21079,-0.80592],
      [51.21082,-0.80549],
      [51.21096,-0.80553],
      [51.21098,-0.80553],
      [51.21102,-0.80551],
      [51.21104,-0.80547],
      [51.21105,-0.80544],
      [51.21106,-0.8054],
      [51.21107,-0.80532],
      [51.21107,-0.80519],
      [51.21106,-0.80474],
      [51.21139,-0.80475],
      [51.2117,-0.80475],
      [51.2117,-0.80425],
      [51.2117,-0.80475],
      [51.21139,-0.80475],
      [51.21106,-0.80474],
      [51.21107,-0.80519],
      [51.21107,-0.80532],
      [51.21106,-0.8054],
      [51.21105,-0.80544],
      [51.21104,-0.80547],
      [51.21102,-0.80551],
      [51.21098,-0.80553],
      [51.21096,-0.80553],
      [51.21082,-0.80549],
      [51.21079,-0.80592],
      [51.21078,-0.80598],
      [51.21076,-0.80602],
      [51.21066,-0.80623],
      [51.21063,-0.80631],
      [51.21061,-0.8064],
      [51.21061,-0.80649],
      [51.21062,-0.80662],
      [51.21065,-0.80673],
      [51.21069,-0.80683],
      [51.21073,-0.80691],
      [51.2109,-0.80715],
      [51.21102,-0.80734],
      [51.21107,-0.80742],
      [51.21122,-0.80768],
      [51.21138,-0.80801],
      [51.21137,-0.80802],
      [51.21136,-0.80802],
      [51.21136,-0.80803],
      [51.21135,-0.80804],
      [51.21135,-0.80805],
      [51.21135,-0.80806],
      [51.21134,-0.80806],
      [51.21134,-0.80807],
      [51.21134,-0.80808],
      [51.21133,-0.80809],
      [51.21133,-0.8081],
      [51.21133,-0.80811],
      [51.21133,-0.80812],
      [51.21133,-0.80813],
      [51.21133,-0.80814],
      [51.21132,-0.80814],
      [51.21132,-0.80815],
      [51.21132,-0.80816],
      [51.21133,-0.80817],
      [51.21133,-0.80818],
      [51.21133,-0.80819],
      [51.21133,-0.8082],
      [51.21133,-0.80821],
      [51.21133,-0.80822],
      [51.21134,-0.80823],
      [51.21134,-0.80824],
      [51.21134,-0.80825],
      [51.21135,-0.80825],
      [51.21135,-0.80826],
      [51.21135,-0.80827],
      [51.21136,-0.80827],
      [51.21136,-0.80828],
      [51.21137,-0.80829],
      [51.21138,-0.80829],
      [51.21138,-0.8083],
      [51.21139,-0.8083],
      [51.21139,-0.80831],
      [51.21131,-0.80852],
      [51.21123,-0.80874],
      [51.21115,-0.80896],
      [51.21099,-0.80941],
      [51.21095,-0.80956],
      [51.21091,-0.80971],
      [51.21088,-0.80982],
      [51.21084,-0.80992],
      [51.2108,-0.81002],
      [51.2107,-0.81022],
      [51.21052,-0.81055],
      [51.21046,-0.81066],
      [51.21052,-0.81075],
      [51.21075,-0.81102],
      [51.21077,-0.81104],
      [51.21079,-0.81105],
      [51.21081,-0.81105],
      [51.21083,-0.81104],
      [51.21084,-0.81103],
      [51.21086,-0.81101],
      [51.21088,-0.81099],
      [51.21097,-0.81077],
      [51.21098,-0.81076],
      [51.21098,-0.81075],
      [51.21099,-0.81074],
      [51.21101,-0.81073],
      [51.21103,-0.81074],
      [51.21105,-0.81076],
      [51.21111,-0.81082],
      [51.2112,-0.81094],
      [51.21111,-0.81082],
      [51.21105,-0.81076],
      [51.21103,-0.81074],
      [51.21101,-0.81073],
      [51.21099,-0.81074],
      [51.21098,-0.81075],
      [51.21098,-0.81076],
      [51.21097,-0.81077],
      [51.21088,-0.81099],
      [51.21086,-0.81101],
      [51.21084,-0.81103],
      [51.21083,-0.81104],
      [51.21081,-0.81105],
      [51.21079,-0.81105],
      [51.21077,-0.81104],
      [51.21075,-0.81102],
      [51.21052,-0.81075],
      [51.21046,-0.81066],
      [51.21029,-0.81102],
      [51.21024,-0.81113],
      [51.21013,-0.81139],
      [51.21027,-0.81157],
      [51.21041,-0.81174],
      [51.21068,-0.81209],
      [51.21075,-0.81214],
      [51.21085,-0.81221],
      [51.21083,-0.81241],
      [51.2108,-0.81249],
      [51.21054,-0.81305],
      [51.21048,-0.81317],
      [51.21043,-0.81328],
      [51.21041,-0.81333],
      [51.21039,-0.8134],
      [51.21039,-0.81341],
      [51.21039,-0.81342],
      [51.21039,-0.81343],
      [51.21039,-0.81345],
      [51.21039,-0.81347],
      [51.21023,-0.81346],
      [51.2102,-0.81346],
      [51.21009,-0.81344],
      [51.2102,-0.81346],
      [51.21023,-0.81346],
      [51.21039,-0.81347],
      [51.21039,-0.81345],
      [51.21039,-0.81343],
      [51.21039,-0.81342],
      [51.21039,-0.81341],
      [51.21039,-0.8134],
      [51.21041,-0.81333],
      [51.21043,-0.81328],
      [51.21048,-0.81317],
      [51.21054,-0.81305],
      [51.2108,-0.81249],
      [51.21083,-0.81241],
      [51.21085,-0.81221],
      [51.21093,-0.81222],
      [51.21114,-0.81225],
      [51.21123,-0.81226],
      [51.21123,-0.81218],
      [51.21123,-0.81212],
      [51.21124,-0.81207],
      [51.21128,-0.81198],
      [51.21138,-0.81171],
      [51.21125,-0.81152],
      [51.21115,-0.81138],
      [51.21125,-0.81152],
      [51.21138,-0.81171],
      [51.21128,-0.81198],
      [51.21124,-0.81207],
      [51.21123,-0.81212],
      [51.21123,-0.81218],
      [51.21123,-0.81226],
      [51.21135,-0.81227],
      [51.21134,-0.81268],
      [51.21132,-0.81278],
      [51.21131,-0.81282],
      [51.2113,-0.81287],
      [51.2113,-0.81288],
      [51.21088,-0.81381],
      [51.2113,-0.81288],
      [51.2113,-0.81287],
      [51.21131,-0.81282],
      [51.21132,-0.81278],
      [51.21134,-0.81268],
      [51.21135,-0.81227],
      [51.21139,-0.81228],
      [51.21164,-0.8123],
      [51.21181,-0.81236],
      [51.21185,-0.81223],
      [51.21191,-0.81206],
      [51.21195,-0.81195],
      [51.21199,-0.81187],
      [51.21199,-0.81186],
      [51.21204,-0.81182],
      [51.21208,-0.81183],
      [51.21211,-0.81187],
      [51.21214,-0.8119],
      [51.21222,-0.81201],
      [51.21229,-0.81212],
      [51.21247,-0.81232],
      [51.21229,-0.81212],
      [51.21222,-0.81201],
      [51.21214,-0.8119],
      [51.21211,-0.81187],
      [51.21208,-0.81183],
      [51.21204,-0.81182],
      [51.21199,-0.81186],
      [51.21199,-0.81187],
      [51.21195,-0.81195],
      [51.21191,-0.81206],
      [51.21185,-0.81223],
      [51.21181,-0.81236],
      [51.21197,-0.81248],
      [51.21212,-0.81265],
      [51.21168,-0.81362],
      [51.21172,-0.81367],
      [51.21174,-0.81369],
      [51.21175,-0.8137],
      [51.21177,-0.81371],
      [51.21193,-0.8137],
      [51.21177,-0.81371],
      [51.21175,-0.8137],
      [51.21174,-0.81369],
      [51.21172,-0.81367],
      [51.21168,-0.81362],
      [51.21212,-0.81265],
      [51.21197,-0.81248],
      [51.21181,-0.81236],
      [51.21164,-0.8123],
      [51.21139,-0.81228],
      [51.21135,-0.81227],
      [51.21123,-0.81226],
      [51.21114,-0.81225],
      [51.21093,-0.81222],
      [51.21085,-0.81221],
      [51.21075,-0.81214],
      [51.21068,-0.81209],
      [51.21041,-0.81174],
      [51.21027,-0.81157],
      [51.21013,-0.81139],
      [51.21024,-0.81113],
      [51.21029,-0.81102],
      [51.21046,-0.81066],
      [51.21052,-0.81055],
      [51.2107,-0.81022],
      [51.2108,-0.81002],
      [51.21084,-0.80992],
      [51.21088,-0.80982],
      [51.21091,-0.80971],
      [51.21095,-0.80956],
      [51.21099,-0.80941],
      [51.21115,-0.80896],
      [51.21123,-0.80874],
      [51.21131,-0.80852],
      [51.21139,-0.80831],
      [51.2114,-0.80831],
      [51.21141,-0.80831],
      [51.21142,-0.80831],
      [51.21143,-0.80831],
      [51.21144,-0.80831],
      [51.21145,-0.80831],
      [51.21146,-0.80831],
      [51.21146,-0.8083],
      [51.21147,-0.8083],
      [51.21148,-0.80829],
      [51.21149,-0.80828],
      [51.21149,-0.80827],
      [51.2115,-0.80827],
      [51.2115,-0.80826],
      [51.21151,-0.80825],
      [51.21151,-0.80824],
      [51.21151,-0.80823],
      [51.21152,-0.80823],
      [51.21152,-0.80822],
      [51.21152,-0.80821],
      [51.21152,-0.8082],
      [51.21152,-0.80819],
      [51.21153,-0.80818],
      [51.21153,-0.80817],
      [51.21153,-0.80816],
      [51.21153,-0.80815],
      [51.21153,-0.80814],
      [51.21153,-0.80813],
      [51.21152,-0.80812],
      [51.21152,-0.80811],
      [51.21152,-0.8081],
      [51.2116,-0.80803],
      [51.21166,-0.80794],
      [51.21192,-0.80754],
      [51.21215,-0.80787],
      [51.21231,-0.8081],
      [51.21241,-0.80824],
      [51.2126,-0.80852],
      [51.21288,-0.80884],
      [51.21316,-0.80917],
      [51.21327,-0.80937],
      [51.2134,-0.80961],
      [51.21352,-0.80979],
      [51.21353,-0.80981],
      [51.21368,-0.81012],
      [51.21376,-0.81033],
      [51.21383,-0.81055],
      [51.21386,-0.8107],
      [51.21388,-0.81086],
      [51.21389,-0.81092],
      [51.2139,-0.8111],
      [51.21392,-0.81121],
      [51.21393,-0.81135],
      [51.21402,-0.81206],
      [51.21402,-0.81207],
      [51.21406,-0.81248],
      [51.21417,-0.81293],
      [51.21441,-0.81365],
      [51.21442,-0.81368],
      [51.2143,-0.81394],
      [51.21422,-0.81393],
      [51.21412,-0.81392],
      [51.21411,-0.81392],
      [51.21394,-0.81392],
      [51.21385,-0.81393],
      [51.21366,-0.81395],
      [51.21357,-0.81396],
      [51.21334,-0.81398],
      [51.21324,-0.81398],
      [51.21316,-0.81397],
      [51.21308,-0.81395],
      [51.21297,-0.81391],
      [51.21299,-0.81432],
      [51.21299,-0.81442],
      [51.21294,-0.81455],
      [51.21293,-0.81458],
      [51.2129,-0.81464],
      [51.21284,-0.81476],
      [51.21236,-0.81483],
      [51.21192,-0.81488],
      [51.21172,-0.81489],
      [51.2113,-0.81492],
      [51.21128,-0.81493],
      [51.21132,-0.81502],
      [51.21145,-0.81534],
      [51.21187,-0.81645],
      [51.21253,-0.81633],
      [51.21257,-0.81636],
      [51.21262,-0.81638],
      [51.21267,-0.81639],
      [51.21272,-0.81639],
      [51.21276,-0.81639],
      [51.2128,-0.81637],
      [51.21284,-0.81633],
      [51.21289,-0.81626],
      [51.21278,-0.81622],
      [51.21275,-0.81621],
      [51.21273,-0.81621],
      [51.2127,-0.81622],
      [51.21268,-0.81622],
      [51.21266,-0.81623],
      [51.21262,-0.81625],
      [51.2126,-0.81626],
      [51.21253,-0.81633],
      [51.21187,-0.81645],
      [51.21145,-0.81534],
      [51.21132,-0.81502],
      [51.21128,-0.81493],
      [51.2113,-0.81492],
      [51.21172,-0.81489],
      [51.21192,-0.81488],
      [51.21236,-0.81483],
      [51.21284,-0.81476],
      [51.2129,-0.81464],
      [51.21293,-0.81458],
      [51.21294,-0.81455],
      [51.21299,-0.81442],
      [51.21299,-0.81432],
      [51.21297,-0.81391],
      [51.21308,-0.81395],
      [51.21316,-0.81397],
      [51.21324,-0.81398],
      [51.21334,-0.81398],
      [51.21357,-0.81396],
      [51.21366,-0.81395],
      [51.21385,-0.81393],
      [51.21394,-0.81392],
      [51.21411,-0.81392],
      [51.21412,-0.81392],
      [51.21422,-0.81393],
      [51.2143,-0.81394],
      [51.21438,-0.81401],
      [51.21442,-0.81402],
      [51.21446,-0.81403],
      [51.21452,-0.81403],
      [51.21447,-0.81384],
      [51.21442,-0.81368],
      [51.21441,-0.81365],
      [51.21417,-0.81293],
      [51.21406,-0.81248],
      [51.21402,-0.81207],
      [51.21402,-0.81206],
      [51.21393,-0.81135],
      [51.21392,-0.81121],
      [51.2139,-0.8111],
      [51.21389,-0.81092],
      [51.21388,-0.81086],
      [51.21386,-0.8107],
      [51.21383,-0.81055],
      [51.21376,-0.81033],
      [51.21368,-0.81012],
      [51.21353,-0.80981],
      [51.21352,-0.80979],
      [51.2134,-0.80961],
      [51.21327,-0.80937],
      [51.21316,-0.80917],
      [51.21288,-0.80884],
      [51.2126,-0.80852],
      [51.21241,-0.80824],
      [51.21231,-0.8081],
      [51.21215,-0.80787],
      [51.21192,-0.80754],
      [51.21166,-0.80794],
      [51.2116,-0.80803],
      [51.21152,-0.8081],
      [51.21152,-0.80809],
      [51.21152,-0.80808],
      [51.21151,-0.80807],
      [51.21151,-0.80806],
      [51.2115,-0.80805],
      [51.2115,-0.80804],
      [51.21149,-0.80803],
      [51.21149,-0.80802],
      [51.21148,-0.80802],
      [51.21147,-0.80801],
      [51.21146,-0.808],
      [51.21145,-0.808],
      [51.21144,-0.80799],
      [51.21143,-0.80799],
      [51.21142,-0.80799],
      [51.21141,-0.80799],
      [51.2114,-0.808],
      [51.21139,-0.808],
      [51.21138,-0.80801],
      [51.21137,-0.80802],
      [51.21136,-0.80802],
      [51.21136,-0.80803],
      [51.21135,-0.80804],
      [51.21135,-0.80805],
      [51.21135,-0.80806],
      [51.21134,-0.80806],
      [51.21134,-0.80807],
      [51.21134,-0.80808],
      [51.21133,-0.80809],
      [51.21133,-0.8081],
      [51.21133,-0.80811],
      [51.21133,-0.80812],
      [51.21133,-0.80813],
      [51.21133,-0.80814],
      [51.21132,-0.80814],
      [51.21132,-0.80815],
      [51.21132,-0.80816],
      [51.21133,-0.80817],
      [51.21133,-0.80818],
      [51.21133,-0.80819],
      [51.21133,-0.8082],
      [51.21133,-0.80821],
      [51.21133,-0.80822],
      [51.21134,-0.80823],
      [51.21134,-0.80824],
      [51.21134,-0.80825],
      [51.21135,-0.80825],
      [51.21135,-0.80826],
      [51.21135,-0.80827],
      [51.21136,-0.80827],
      [51.21136,-0.80828],
      [51.21137,-0.80829],
      [51.21138,-0.80829],
      [51.21138,-0.8083],
      [51.21139,-0.8083],
      [51.21139,-0.80831],
      [51.21131,-0.80852],
      [51.21123,-0.80874],
      [51.21115,-0.80896],
      [51.21099,-0.80941],
      [51.21095,-0.80956],
      [51.21091,-0.80971],
      [51.21088,-0.80982],
      [51.21084,-0.80992],
      [51.2108,-0.81002],
      [51.2107,-0.81022],
      [51.21052,-0.81055],
      [51.21046,-0.81066],
      [51.21029,-0.81102],
      [51.21024,-0.81113],
      [51.21013,-0.81139],
      [51.21027,-0.81157],
      [51.21041,-0.81174],
      [51.21068,-0.81209],
      [51.21075,-0.81214],
      [51.21085,-0.81221],
      [51.21093,-0.81222],
      [51.21114,-0.81225],
      [51.21123,-0.81226],
      [51.21135,-0.81227],
      [51.21139,-0.81228],
      [51.21164,-0.8123],
      [51.21181,-0.81236],
      [51.21197,-0.81248],
      [51.21212,-0.81265],
      [51.21168,-0.81362],
      [51.21172,-0.81367],
      [51.21174,-0.81369],
      [51.21175,-0.8137],
      [51.21177,-0.81371],
      [51.21193,-0.8137],
      [51.21177,-0.81371],
      [51.21175,-0.8137],
      [51.21174,-0.81369],
      [51.21172,-0.81367],
      [51.21168,-0.81362],
      [51.21212,-0.81265],
      [51.21197,-0.81248],
      [51.21181,-0.81236],
      [51.21164,-0.8123],
      [51.21139,-0.81228],
      [51.21135,-0.81227],
      [51.21123,-0.81226],
      [51.21114,-0.81225],
      [51.21093,-0.81222],
      [51.21085,-0.81221],
      [51.21075,-0.81214],
      [51.21068,-0.81209],
      [51.21041,-0.81174],
      [51.21027,-0.81157],
      [51.21013,-0.81139],
      [51.21024,-0.81113],
      [51.21029,-0.81102],
      [51.21046,-0.81066],
      [51.21052,-0.81055],
      [51.2107,-0.81022],
      [51.2108,-0.81002],
      [51.21084,-0.80992],
      [51.21088,-0.80982],
      [51.21091,-0.80971],
      [51.21095,-0.80956],
      [51.21099,-0.80941],
      [51.21115,-0.80896],
      [51.21123,-0.80874],
      [51.21131,-0.80852],
      [51.21139,-0.80831],
      [51.2114,-0.80831],
      [51.21141,-0.80831],
      [51.21142,-0.80831],
      [51.21143,-0.80831],
      [51.21144,-0.80831],
      [51.21145,-0.80831],
      [51.21146,-0.80831],
      [51.21146,-0.8083],
      [51.21147,-0.8083],
      [51.21148,-0.80829],
      [51.21149,-0.80828],
      [51.21149,-0.80827],
      [51.2115,-0.80827],
      [51.2115,-0.80826],
      [51.21151,-0.80825],
      [51.21151,-0.80824],
      [51.21151,-0.80823],
      [51.21152,-0.80823],
      [51.21152,-0.80822],
      [51.21152,-0.80821],
      [51.21152,-0.8082],
      [51.21152,-0.80819],
      [51.21153,-0.80818],
      [51.21153,-0.80817],
      [51.21153,-0.80816],
      [51.21153,-0.80815],
      [51.21153,-0.80814],
      [51.21153,-0.80813],
      [51.21152,-0.80812],
      [51.21152,-0.80811],
      [51.21152,-0.8081],
      [51.2116,-0.80803],
      [51.21166,-0.80794],
      [51.21192,-0.80754],
      [51.21215,-0.80787],
      [51.21231,-0.8081],
      [51.21241,-0.80824],
      [51.2126,-0.80852],
      [51.21288,-0.80884],
      [51.21316,-0.80917],
      [51.21327,-0.80937],
      [51.2134,-0.80961],
      [51.21352,-0.80979],
      [51.21353,-0.80981],
      [51.21368,-0.81012],
      [51.21376,-0.81033],
      [51.21383,-0.81055],
      [51.21386,-0.8107],
      [51.21388,-0.81086],
      [51.21389,-0.81092],
      [51.2139,-0.8111],
      [51.21392,-0.81121],
      [51.21393,-0.81135],
      [51.21402,-0.81206],
      [51.21402,-0.81207],
      [51.21406,-0.81248],
      [51.21417,-0.81293],
      [51.21441,-0.81365],
      [51.21442,-0.81368],
      [51.2143,-0.81394],
      [51.21422,-0.81393],
      [51.21412,-0.81392],
      [51.21411,-0.81392],
      [51.21394,-0.81392],
      [51.21385,-0.81393],
      [51.21366,-0.81395],
      [51.21357,-0.81396],
      [51.21334,-0.81398],
      [51.21324,-0.81398],
      [51.21316,-0.81397],
      [51.21308,-0.81395],
      [51.21297,-0.81391],
      [51.21299,-0.81432],
      [51.21299,-0.81433],
    ]
    
    const folly_hill_latlngs = [
      [51.2276753,-0.8094354],
      [51.227729,-0.8100295],
      [51.2278306,-0.8101904],
      [51.2283068,-0.8103151],
      [51.2286629,-0.8103353],
      [51.2287225,-0.8102789],
      [51.228825,-0.809312],
      [51.2292667,-0.8094823],
      [51.2288275,-0.8092999],
      [51.2288871,-0.8089177],
      [51.2288477,-0.8087045],
      [51.2284945,-0.8088916],
      [51.2282086,-0.808046],
      [51.2284945,-0.8088916],
      [51.2288477,-0.8087045],
      [51.22947,-0.80766],
      [51.22973,-0.80733],
      [51.22981,-0.80726],
      [51.22985,-0.80723],
      [51.22989,-0.80717],
      [51.22992,-0.80713],
      [51.22999,-0.80704],
      [51.23005,-0.8069],
      [51.23016,-0.80668],
      [51.23019,-0.80661],
      [51.23038,-0.80674],
      [51.23069,-0.80699],
      [51.23072,-0.80701],
      [51.23061,-0.80774],
      [51.23059,-0.80788],
      [51.23057,-0.80793],
      [51.23055,-0.80797],
      [51.23047,-0.80802],
      [51.23055,-0.80797],
      [51.23057,-0.80793],
      [51.23059,-0.80788],
      [51.23061,-0.80774],
      [51.23072,-0.80701],
      [51.23083,-0.80706],
      [51.23135,-0.80725],
      [51.23119,-0.80857],
      [51.23114,-0.80881],
      [51.23103,-0.80908],
      [51.23114,-0.80881],
      [51.23119,-0.80857],
      [51.23135,-0.80725],
      [51.23143,-0.80618],
      [51.23143,-0.80613],
      [51.23144,-0.80599],
      [51.23146,-0.80557],
      [51.2315,-0.80545],
      [51.23152,-0.80537],
      [51.23154,-0.80531],
      [51.23157,-0.80525],
      [51.23163,-0.80516],
      [51.23167,-0.80511],
      [51.23174,-0.80504],
      [51.23182,-0.80498],
      [51.23188,-0.80495],
      [51.23191,-0.80494],
      [51.23195,-0.80494],
      [51.23198,-0.80494],
      [51.23201,-0.80495],
      [51.23204,-0.80497],
      [51.23209,-0.80501],
      [51.23214,-0.80506],
      [51.23218,-0.8051],
      [51.2323,-0.80529],
      [51.23222,-0.8054],
      [51.23211,-0.80559],
      [51.23206,-0.80572],
      [51.23201,-0.80604],
      [51.23195,-0.80653],
      [51.23201,-0.80604],
      [51.23206,-0.80572],
      [51.23211,-0.80559],
      [51.23222,-0.8054],
      [51.2323,-0.80529],
      [51.23243,-0.80546],
      [51.23251,-0.80558],
      [51.23255,-0.80567],
      [51.23257,-0.80575],
      [51.23258,-0.80584],
      [51.23259,-0.80592],
      [51.23259,-0.80599],
      [51.23258,-0.80608],
      [51.23256,-0.80617],
      [51.23255,-0.80622],
      [51.23252,-0.80633],
      [51.23249,-0.80644],
      [51.23247,-0.80657],
      [51.23247,-0.80666],
      [51.23248,-0.80677],
      [51.23248,-0.80685],
      [51.2325,-0.80695],
      [51.23253,-0.80702],
      [51.23258,-0.80714],
      [51.23265,-0.80724],
      [51.23278,-0.80737],
      [51.23274,-0.80749],
      [51.23271,-0.80756],
      [51.23269,-0.80766],
      [51.23268,-0.80777],
      [51.23269,-0.80795],
      [51.23258,-0.80798],
      [51.23246,-0.80799],
      [51.23226,-0.80796],
      [51.23246,-0.80799],
      [51.23258,-0.80798],
      [51.23269,-0.80795],
      [51.23271,-0.80826],
      [51.23271,-0.80832],
      [51.2327,-0.8085],
      [51.23264,-0.80881],
      [51.23263,-0.80889],
      [51.23263,-0.80892],
      [51.23263,-0.80894],
      [51.23265,-0.80896],
      [51.23269,-0.80901],
      [51.23273,-0.80904],
      [51.23277,-0.80905],
      [51.23295,-0.80911],
      [51.23277,-0.80905],
      [51.23273,-0.80904],
      [51.23269,-0.80901],
      [51.23265,-0.80896],
      [51.23263,-0.80894],
      [51.23263,-0.80892],
      [51.23263,-0.80889],
      [51.23264,-0.80881],
      [51.2327,-0.8085],
      [51.23271,-0.80832],
      [51.23289,-0.80832],
      [51.23298,-0.80833],
      [51.23305,-0.80836],
      [51.23306,-0.80837],
      [51.23305,-0.80836],
      [51.23298,-0.80833],
      [51.23289,-0.80832],
      [51.23271,-0.80832],
      [51.23271,-0.80826],
      [51.23269,-0.80795],
      [51.23268,-0.80777],
      [51.23269,-0.80766],
      [51.23271,-0.80756],
      [51.23274,-0.80749],
      [51.23278,-0.80737],
      [51.23293,-0.80745],
      [51.23306,-0.80747],
      [51.23318,-0.80747],
      [51.23336,-0.80741],
      [51.23342,-0.80752],
      [51.23348,-0.80765],
      [51.23357,-0.80783],
      [51.23379,-0.80823],
      [51.23392,-0.80815],
      [51.23399,-0.80813],
      [51.23405,-0.80814],
      [51.23442,-0.80816],
      [51.23439,-0.8078],
      [51.23433,-0.80741],
      [51.23439,-0.8078],
      [51.23442,-0.80816],
      [51.23449,-0.80816],
      [51.23455,-0.80816],
      [51.23457,-0.80817],
      [51.23459,-0.8082],
      [51.2346,-0.80822],
      [51.23472,-0.80873],
      [51.2346,-0.80822],
      [51.23459,-0.8082],
      [51.23457,-0.80817],
      [51.23455,-0.80816],
      [51.23449,-0.80816],
      [51.23442,-0.80816],
      [51.23405,-0.80814],
      [51.23399,-0.80813],
      [51.23392,-0.80815],
      [51.23379,-0.80823],
      [51.23357,-0.80783],
      [51.23367,-0.8077],
      [51.23373,-0.80765],
      [51.2338,-0.80761],
      [51.23387,-0.80757],
      [51.23402,-0.80755],
      [51.23387,-0.80757],
      [51.2338,-0.80761],
      [51.23373,-0.80765],
      [51.23367,-0.8077],
      [51.23357,-0.80783],
      [51.23348,-0.80765],
      [51.23342,-0.80752],
      [51.23336,-0.80741],
      [51.23333,-0.80694],
      [51.23333,-0.80677],
      [51.23342,-0.80678],
      [51.23347,-0.80677],
      [51.2335,-0.80675],
      [51.23362,-0.80665],
      [51.2335,-0.80675],
      [51.23347,-0.80677],
      [51.23342,-0.80678],
      [51.23333,-0.80677],
      [51.23333,-0.80656],
      [51.23334,-0.80638],
      [51.23334,-0.80628],
      [51.23335,-0.80617],
      [51.23337,-0.80598],
      [51.23317,-0.80578],
      [51.23296,-0.80553],
      [51.23276,-0.80523],
      [51.23298,-0.8049],
      [51.23291,-0.80474],
      [51.23298,-0.8049],
      [51.23276,-0.80523],
      [51.2326,-0.80494],
      [51.23242,-0.80464],
      [51.23229,-0.80448],
      [51.23214,-0.80436],
      [51.23201,-0.80429],
      [51.23185,-0.80426],
      [51.23166,-0.80424],
      [51.23154,-0.80426],
      [51.23147,-0.80356],
      [51.23146,-0.80345],
      [51.23134,-0.80276],
      [51.23132,-0.80252],
      [51.23131,-0.80235],
      [51.2313,-0.80227],
      [51.23126,-0.8021],
      [51.2312,-0.80195],
      [51.23116,-0.80188],
      [51.2311,-0.80179],
      [51.23108,-0.80177],
      [51.23098,-0.80167],
      [51.23108,-0.80177],
      [51.2311,-0.80179],
      [51.23116,-0.80188],
      [51.2312,-0.80195],
      [51.23126,-0.8021],
      [51.2313,-0.80227],
      [51.23131,-0.80235],
      [51.23132,-0.80252],
      [51.23134,-0.80276],
      [51.23146,-0.80345],
      [51.23147,-0.80356],
      [51.23154,-0.80426],
      [51.23143,-0.80433],
      [51.2313,-0.80442],
      [51.23119,-0.80457],
      [51.23103,-0.80483],
      [51.23095,-0.805],
      [51.23079,-0.80533],
      [51.2304,-0.80614],
      [51.23019,-0.80661],
      [51.23016,-0.80668],
      [51.23005,-0.8069],
      [51.22999,-0.80704],
      [51.22992,-0.80713],
      [51.22989,-0.80717],
      [51.22985,-0.80723],
      [51.22981,-0.80726],
      [51.22973,-0.80733],
      [51.22967,-0.80714],
      [51.22965,-0.80707],
      [51.22964,-0.807],
      [51.22963,-0.80693],
      [51.22963,-0.80683],
      [51.22963,-0.80674],
      [51.22963,-0.80666],
      [51.22965,-0.80656],
      [51.22965,-0.80649],
      [51.22966,-0.80646],
      [51.22967,-0.80643],
      [51.22961,-0.80636],
      [51.2295,-0.80614],
      [51.22944,-0.80605],
      [51.2293,-0.8059],
      [51.22912,-0.80584],
      [51.2289,-0.80582],
      [51.2288,-0.80582],
      [51.2289,-0.80582],
      [51.22912,-0.80584],
      [51.2293,-0.8059],
      [51.22944,-0.80605],
      [51.2295,-0.80614],
      [51.22961,-0.80636],
      [51.22967,-0.80643],
      [51.2298,-0.80629],
      [51.22989,-0.80618],
      [51.23,-0.80599],
      [51.23006,-0.80586],
      [51.2301,-0.80572],
      [51.23016,-0.80549],
      [51.23019,-0.80533],
      [51.23021,-0.80518],
      [51.23024,-0.80504],
      [51.23024,-0.805],
      [51.23025,-0.80496],
      [51.23028,-0.80452],
      [51.23029,-0.80448],
      [51.23029,-0.80446],
      [51.23031,-0.80434],
      [51.23034,-0.8042],
      [51.23037,-0.80412],
      [51.2304,-0.80403],
      [51.23045,-0.80392],
      [51.23056,-0.80369],
      [51.23068,-0.80348],
      [51.23078,-0.80322],
    ]
    
    const heath_end_latlngs = [
      [51.2292448,-0.7863096],
      [51.2294948,-0.7861296],
      [51.2296648,-0.7859996],
      [51.2297348,-0.7859796],
      [51.2298448,-0.7859696],
      [51.2299648,-0.7860596],
      [51.2300548,-0.7861096],
      [51.2301148,-0.7861296],
      [51.2301748,-0.7861196],
      [51.2302348,-0.7860896],
      [51.2303048,-0.7860196],
      [51.2306848,-0.7855396],
      [51.2307448,-0.7854596],
      [51.2307848,-0.7854196],
      [51.2308148,-0.7853996],
      [51.2308648,-0.7853896],
      [51.2309248,-0.7853996],
      [51.2309648,-0.7854096],
      [51.2309948,-0.7854296],
      [51.2310448,-0.7854596],
      [51.2310748,-0.7855096],
      [51.2312248,-0.7858196],
      [51.2312548,-0.7858896],
      [51.2312248,-0.7858196],
      [51.2310748,-0.7855096],
      [51.2310448,-0.7854596],
      [51.2309948,-0.7854296],
      [51.2309648,-0.7854096],
      [51.2309248,-0.7853996],
      [51.2308648,-0.7853896],
      [51.2308148,-0.7853996],
      [51.2307848,-0.7854196],
      [51.2307448,-0.7854596],
      [51.2306848,-0.7855396],
      [51.2303048,-0.7860196],
      [51.2302348,-0.7860896],
      [51.2301748,-0.7861196],
      [51.2301148,-0.7861296],
      [51.2300548,-0.7861096],
      [51.2299648,-0.7860596],
      [51.2298448,-0.7859696],
      [51.2297348,-0.7859796],
      [51.2296648,-0.7859996],
      [51.2294948,-0.7861296],
      [51.2291948,-0.7863496],
      [51.2292448,-0.7866096],
      [51.2292948,-0.7867796],
      [51.2293548,-0.7869096],
      [51.2294248,-0.7870396],
      [51.2294348,-0.7870596],
      [51.2295448,-0.7872896],
      [51.2296548,-0.7874796],
      [51.2297848,-0.7876896],
      [51.2299148,-0.7879196],
      [51.2300348,-0.7881496],
      [51.2300948,-0.7883096],
      [51.2301548,-0.7884196],
      [51.2301948,-0.7884796],
      [51.2302948,-0.7886095],
      [51.2305348,-0.7887595],
      [51.2306348,-0.7888795],
      [51.2307948,-0.7890995],
      [51.2311248,-0.7886395],
      [51.2312548,-0.7884696],
      [51.2316648,-0.7892695],
      [51.2317048,-0.7893195],
      [51.2317548,-0.7893595],
      [51.2317848,-0.7893595],
      [51.2318348,-0.7893495],
      [51.2318848,-0.7893295],
      [51.2319048,-0.7893095],
      [51.2319348,-0.7892695],
      [51.2319548,-0.7892095],
      [51.2319548,-0.7891695],
      [51.2319348,-0.7888895],
      [51.2316948,-0.7875996],
      [51.2323548,-0.7872396],
      [51.2323948,-0.7874096],
      [51.2324048,-0.7874496],
      [51.2324748,-0.7876896],
      [51.2325748,-0.7878796],
      [51.2326348,-0.7879496],
      [51.2327048,-0.7879696],
      [51.2328148,-0.7879496],
      [51.2337448,-0.7876196],
      [51.2338148,-0.7875896],
      [51.2342348,-0.7874396],
      [51.2342948,-0.7878996],
      [51.2342348,-0.7874396],
      [51.2348248,-0.7872596],
      [51.2349148,-0.7871896],
      [51.2349748,-0.7871196],
      [51.2350248,-0.7870296],
      [51.2350148,-0.7869696],
      [51.2350148,-0.7869196],
      [51.2349748,-0.7866696],
      [51.2349748,-0.7865896],
      [51.2349348,-0.7863896],
      [51.2348948,-0.7862696],
      [51.2348448,-0.7862096],
      [51.2347048,-0.7861396],
      [51.2344448,-0.7860596],
      [51.2342248,-0.7861396],
      [51.2334448,-0.7864396],
      [51.2322948,-0.7868696],
      [51.2319948,-0.7852096],
      [51.2319848,-0.7849496],
      [51.2324748,-0.7849996],
      [51.2325348,-0.7849996],
      [51.2326248,-0.7849796],
      [51.2328348,-0.7849196],
      [51.2332648,-0.7847796],
      [51.2339548,-0.7847496],
      [51.2341848,-0.7847396],
      [51.2343148,-0.7847196],
      [51.2345348,-0.7847296],
      [51.2346748,-0.7847696],
      [51.2348748,-0.7848796],
      [51.2350848,-0.7850896],
      [51.2352148,-0.7852096],
      [51.2355348,-0.7855996],
      [51.2359048,-0.7860196],
      [51.2363348,-0.7864096],
      [51.2365148,-0.7865696],
      [51.2368548,-0.7867996],
      [51.2370648,-0.7868996],
      [51.2373648,-0.7870096],
      [51.2377648,-0.7869796],
      [51.2378248,-0.7869796],
      [51.2378548,-0.7874996],
      [51.2378748,-0.7877196],
      [51.2379148,-0.7881396],
      [51.2379248,-0.7882396],
      [51.2376948,-0.7882496],
      [51.2371848,-0.7882796],
      [51.2370748,-0.7883096],
      [51.2367748,-0.7886495],
      [51.2365548,-0.7889195],
      [51.2367548,-0.7894295],
      [51.2368848,-0.7895995],
      [51.2369848,-0.7897395],
      [51.2370748,-0.7898395],
      [51.2371048,-0.7898595],
      [51.2371348,-0.7898595],
      [51.2371848,-0.7898495],
      [51.2372748,-0.7897895],
      [51.2374948,-0.7895795],
      [51.2372748,-0.7897895],
      [51.2371848,-0.7898495],
      [51.2371348,-0.7898595],
      [51.2371048,-0.7898595],
      [51.2370748,-0.7898395],
      [51.2369848,-0.7897395],
      [51.2368848,-0.7895995],
      [51.2367548,-0.7894295],
      [51.2367048,-0.7896995],
      [51.2366448,-0.7899895],
      [51.2365448,-0.7901795],
      [51.2363848,-0.7904195],
      [51.2365448,-0.7901795],
      [51.2366448,-0.7899895],
      [51.2367048,-0.7896995],
      [51.2367548,-0.7894295],
      [51.2365548,-0.7889195],
      [51.2363348,-0.7891695],
      [51.2358848,-0.7896395],
      [51.2355648,-0.7899395],
      [51.2353748,-0.7893895],
      [51.2347548,-0.7893395],
      [51.2344548,-0.7893495],
      [51.2342948,-0.7894195],
      [51.2339748,-0.7896295],
      [51.2345648,-0.7908495],
      [51.2348048,-0.7906695],
      [51.2354648,-0.7917995],
      [51.2348048,-0.7906695],
      [51.2350348,-0.7904495],
    ]

    const rowledge_latlngs = [
      [51.18165,-0.81732],
      [51.18203,-0.81706],
      [51.18234,-0.81706],
      [51.18255,-0.81717],
      [51.18256,-0.81718],
      [51.18272,-0.8174],
      [51.18278,-0.81755],
      [51.18279,-0.81758],
      [51.18285,-0.81786],
      [51.18289,-0.81829],
      [51.18293,-0.81847],
      [51.18295,-0.81851],
      [51.18306,-0.81876],
      [51.18321,-0.819],
      [51.18347,-0.81924],
      [51.18367,-0.81934],
      [51.18381,-0.81942],
      [51.18367,-0.81934],
      [51.18347,-0.81924],
      [51.18321,-0.819],
      [51.18306,-0.81876],
      [51.18295,-0.81851],
      [51.18293,-0.81847],
      [51.18289,-0.81829],
      [51.18285,-0.81786],
      [51.18279,-0.81758],
      [51.18278,-0.81755],
      [51.18293,-0.81747],
      [51.18311,-0.81745],
      [51.18344,-0.81766],
      [51.18361,-0.81777],
      [51.18388,-0.81778],
      [51.18392,-0.81776],
      [51.184,-0.81771],
      [51.18403,-0.8177],
      [51.18431,-0.81756],
      [51.18446,-0.81749],
      [51.18469,-0.81739],
      [51.18446,-0.81749],
      [51.18431,-0.81756],
      [51.18403,-0.8177],
      [51.184,-0.81771],
      [51.18392,-0.81776],
      [51.18388,-0.81778],
      [51.18361,-0.81777],
      [51.18344,-0.81766],
      [51.18311,-0.81745],
      [51.18293,-0.81747],
      [51.18278,-0.81755],
      [51.18272,-0.8174],
      [51.18256,-0.81718],
      [51.18274,-0.81659],
      [51.18287,-0.81616],
      [51.18274,-0.81659],
      [51.18256,-0.81718],
      [51.18255,-0.81717],
      [51.18234,-0.81706],
      [51.18203,-0.81706],
      [51.1816,-0.81736],
      [51.18162,-0.81744],
      [51.18173,-0.81789],
      [51.18186,-0.81842],
      [51.18187,-0.8185],
      [51.18218,-0.81981],
      [51.18222,-0.81999],
      [51.18223,-0.82001],
      [51.18231,-0.82033],
      [51.18237,-0.82056],
      [51.18239,-0.82063],
      [51.18257,-0.82117],
      [51.18271,-0.82166],
      [51.18291,-0.82228],
      [51.18294,-0.82236],
      [51.18174,-0.82275],
      [51.18128,-0.82288],
      [51.1811,-0.82293],
      [51.18118,-0.82318],
      [51.18127,-0.82343],
      [51.18142,-0.82396],
      [51.18148,-0.82423],
      [51.18155,-0.82453],
      [51.18161,-0.82499],
      [51.18168,-0.82492],
      [51.18183,-0.82477],
      [51.18204,-0.82456],
      [51.18223,-0.82439],
      [51.18234,-0.82426],
      [51.18251,-0.82407],
      [51.18253,-0.82408],
      [51.18262,-0.82398],
      [51.18264,-0.82395],
      [51.18277,-0.82377],
      [51.18323,-0.82319],
      [51.18329,-0.82332],
      [51.18322,-0.82342],
      [51.18319,-0.82348],
      [51.18316,-0.82357],
      [51.1829,-0.82439],
      [51.1828,-0.82472],
      [51.1825,-0.82578],
      [51.18239,-0.82622],
      [51.18263,-0.82639],
      [51.18276,-0.82645],
      [51.18311,-0.82656],
      [51.18335,-0.82663],
      [51.18359,-0.82674],
      [51.18365,-0.82677],
      [51.18366,-0.82678],
      [51.18401,-0.82696],
      [51.18419,-0.82705],
      [51.18448,-0.8272],
      [51.18475,-0.82732],
      [51.18473,-0.82707],
      [51.18475,-0.82699],
      [51.18476,-0.82696],
      [51.18481,-0.82681],
      [51.18485,-0.82668],
      [51.18492,-0.82634],
      [51.18507,-0.82549],
      [51.18513,-0.82512],
      [51.18515,-0.82504],
      [51.18517,-0.825],
      [51.18519,-0.82498],
      [51.18522,-0.82494],
      [51.18559,-0.82517],
      [51.18561,-0.82517],
      [51.18562,-0.82516],
      [51.18567,-0.82509],
      [51.18568,-0.82507],
      [51.18582,-0.82483],
      [51.18595,-0.82463],
      [51.18602,-0.82451],
      [51.18611,-0.82438],
      [51.18618,-0.82426],
      [51.18622,-0.82417],
      [51.18626,-0.82407],
      [51.18628,-0.82401],
      [51.18632,-0.82395],
      [51.18636,-0.82388],
      [51.1864,-0.82385],
      [51.18645,-0.82383],
      [51.18653,-0.82381],
      [51.18668,-0.82375],
      [51.18676,-0.82357],
      [51.1868,-0.82345],
      [51.18684,-0.82331],
      [51.18685,-0.8233],
      [51.18685,-0.82326],
      [51.18685,-0.82323],
      [51.18684,-0.8232],
      [51.18683,-0.82317],
      [51.18681,-0.82314],
      [51.18679,-0.82313],
      [51.18676,-0.82313],
      [51.18669,-0.82311],
      [51.18661,-0.8231],
      [51.18658,-0.8231],
      [51.18651,-0.82309],
      [51.1864,-0.82304],
      [51.18636,-0.82307],
      [51.1863,-0.82308],
      [51.18617,-0.82307],
      [51.1861,-0.82308],
      [51.18609,-0.82308],
      [51.18603,-0.82308],
      [51.18587,-0.82311],
      [51.18572,-0.82319],
      [51.18558,-0.82328],
      [51.18557,-0.82329],
      [51.18542,-0.82339],
      [51.18531,-0.82346],
      [51.18527,-0.82349],
      [51.18526,-0.82349],
      [51.18524,-0.82351],
      [51.18511,-0.8236],
      [51.18508,-0.82362],
      [51.18501,-0.82368],
      [51.18486,-0.82378],
      [51.18475,-0.82384],
      [51.18474,-0.82385],
      [51.18458,-0.82389],
      [51.18446,-0.82392],
      [51.18419,-0.82398],
      [51.18376,-0.82408],
      [51.18369,-0.82413],
      [51.18366,-0.82408],
      [51.18365,-0.82406],
      [51.18333,-0.82341],
      [51.18329,-0.82332],
      [51.18323,-0.82319],
      [51.18316,-0.82299],
      [51.1831,-0.82282],
      [51.18352,-0.82157],
      [51.18364,-0.82169],
      [51.18382,-0.82189],
      [51.18386,-0.82192],
      [51.18389,-0.82194],
      [51.18393,-0.82195],
      [51.18397,-0.82195],
      [51.18401,-0.82195],
      [51.18404,-0.82195],
      [51.18417,-0.82189],
      [51.18467,-0.82168],
      [51.18474,-0.82165],
      [51.18498,-0.82155],
      [51.18509,-0.82152],
      [51.18522,-0.8215],
      [51.18527,-0.82151],
      [51.18555,-0.82158],
      [51.18565,-0.82159],
      [51.1859,-0.82161],
      [51.18594,-0.82157],
      [51.18596,-0.82155],
      [51.18598,-0.82152],
      [51.186,-0.82147],
      [51.18603,-0.8214],
      [51.18608,-0.82112],
      [51.18611,-0.82083],
      [51.18614,-0.82055],
      [51.18615,-0.8203],
      [51.18556,-0.82005],
      [51.18549,-0.82004],
      [51.18548,-0.8198],
      [51.18547,-0.81959],
      [51.1854,-0.81944],
      [51.18531,-0.81931],
      [51.1853,-0.8193],
      [51.18515,-0.81918],
      [51.18494,-0.81903],
      [51.18483,-0.81891],
      [51.18494,-0.81903],
      [51.18515,-0.81918],
      [51.1853,-0.8193],
      [51.18531,-0.81931],
      [51.1854,-0.81944],
      [51.18547,-0.81959],
      [51.18548,-0.8198],
      [51.18549,-0.82004],
      [51.18538,-0.82002],
      [51.18525,-0.82003],
      [51.18508,-0.82016],
      [51.18483,-0.82042],
      [51.18462,-0.82048],
      [51.18448,-0.82051],
    ]

    const south_farnham_latlngs = [
      [51.2124723,-0.7920655],
      [51.2125923,-0.7919955],
      [51.2126223,-0.7919555],
      [51.2127923,-0.7925655],
      [51.2128223,-0.7927255],
      [51.2128723,-0.7928255],
      [51.2128923,-0.7928555],
      [51.2129123,-0.7928855],
      [51.2129823,-0.7929255],
      [51.2130423,-0.7929155],
      [51.2131323,-0.7927855],
      [51.2134323,-0.7922655],
      [51.2135723,-0.7920555],
      [51.2136523,-0.7919255],
      [51.2136823,-0.7917555],
      [51.2137223,-0.7914855],
      [51.2137523,-0.7913355],
      [51.2138523,-0.7910455],
      [51.2138823,-0.7910055],
      [51.2140323,-0.7907755],
      [51.2144123,-0.7900855],
      [51.2145023,-0.7898855],
      [51.2145523,-0.7897355],
      [51.214992,-0.7875885],
      [51.2153007,-0.7854414],
      [51.2152005,-0.7848272],
      [51.2153113,-0.7854223],
      [51.2150961,-0.7869293],
      [51.2145523,-0.7897355],
      [51.2145023,-0.7898855],
      [51.2144123,-0.7900855],
      [51.2140323,-0.7907755],
      [51.2138823,-0.7910055],
      [51.2138523,-0.7910455],
      [51.2137523,-0.7913355],
      [51.2137223,-0.7914855],
      [51.2136823,-0.7917555],
      [51.2136523,-0.7919255],
      [51.2135723,-0.7920555],
      [51.2134323,-0.7922655],
      [51.2129023,-0.7914655],
      [51.2128923,-0.7914755],
      [51.2126223,-0.7919555],
      [51.2125923,-0.7919955],
      [51.2121623,-0.7922455],
      [51.2121123,-0.7919955],
      [51.2121023,-0.7919455],
      [51.2121123,-0.7918455],
      [51.2119823,-0.7918255],
      [51.2119523,-0.7918255],
      [51.2118523,-0.7917855],
      [51.2118123,-0.7917755],
      [51.2117823,-0.7917655],
      [51.2117423,-0.7917455],
      [51.2117223,-0.7917255],
      [51.2117023,-0.7916955],
      [51.2116523,-0.7916355],
      [51.2116223,-0.7916055],
      [51.2115023,-0.7914355],
      [51.2108823,-0.7905655],
      [51.2106023,-0.7902155],
      [51.2101123,-0.7897755],
      [51.2092623,-0.7890155],
      [51.2091023,-0.7893955],
      [51.2089323,-0.7898255],
      [51.2096323,-0.7904755],
      [51.2099823,-0.7907955],
      [51.2105923,-0.7913555],
      [51.2103123,-0.7921755],
      [51.2102023,-0.7925055],
      [51.2099123,-0.7933855],
      [51.2099123,-0.7934055],
      [51.2095823,-0.7944455],
      [51.2094423,-0.7949355],
      [51.2094123,-0.7950555],
      [51.2092123,-0.7956855],
      [51.2090823,-0.7961355],
      [51.2089623,-0.7960355],
      [51.2086123,-0.7969455],
      [51.2084323,-0.7973755],
      [51.2082123,-0.7978755],
      [51.2080723,-0.7982255],
      [51.20803,-0.79842],
      [51.2077914,-0.7991432],
      [51.2072187,-0.7986651],
      [51.2077868,-0.7991623],
      [51.2076,-0.79974],
      [51.20751,-0.80006],
      [51.20748,-0.80014],
      [51.20746,-0.80017],
      [51.20744,-0.80019],
      [51.20734,-0.80025],
      [51.20699,-0.80042],
      [51.20694,-0.80042],
      [51.20689,-0.80041],
      [51.20683,-0.80039],
      [51.20557,-0.79933],
      [51.20518,-0.79902],
      [51.20444,-0.79843],
      [51.20397,-0.79803],
      [51.20376,-0.79786],
      [51.20296,-0.79726],
      [51.20288,-0.7972],
      [51.20277,-0.7971],
      [51.20274,-0.79706],
      [51.20272,-0.79705],
      [51.20267,-0.79699],
      [51.20233,-0.79657],
      [51.20227,-0.79649],
      [51.20273,-0.79563],
      [51.2016855,-0.795073],
      [51.2007054,-0.7945284],
      [51.2005153,-0.7943807],
    ]

    const central_poly = L.polyline(central_latlngs, {color: 'red',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("Central Farnham: " + central_date.toLocaleDateString("en-GB", date_options));
    const chantrys_poly = L.polyline(chantrys_latlngs, {color: 'blue',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("Chantrys: " + chantrys_date.toLocaleDateString("en-GB", date_options));
    const folly_hill_poly = L.polyline(folly_hill_latlngs, {color: 'green',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("Folly Hill: " + folly_hill_date.toLocaleDateString("en-GB", date_options));
    const heath_end_poly = L.polyline(heath_end_latlngs, {color: 'black',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("Heath End: " + heath_end_date.toLocaleDateString("en-GB", date_options));
    const rowledge_poly = L.polyline(rowledge_latlngs, {color: 'yellow',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("Rowledge: " + rowledge_date.toLocaleDateString("en-GB", date_options));
    const south_farnham_poly = L.polyline(south_farnham_latlngs, {color: 'pink',weight: 3,opacity: 0.9})
                            .addTo(map)
                            .bindPopup("South Farnham: " + south_farnham_date.toLocaleDateString("en-GB", date_options));
    
    function setLive() {
      marker.getPopup().setContent("üéÅ Santa's Current Location");
      statusBox.textContent = 'üéÖ Santa is out on his sleigh delivering joy!';
    }

    function setLapland(message) {
      marker.getPopup().setContent(message || "üéÑ GPS inactive ‚Äì fallback to Lapland");
      statusBox.textContent = 'üéÑ Santa is currently in Lapland preparing for Christmas!';
    }

    let followSanta = true;

    followBtn.addEventListener('click', () => {
      followSanta = !followSanta;
      followBtn.textContent = `Follow Santa: ${followSanta ? 'ON' : 'OFF'}`;
      if (followSanta) map.panTo(marker.getLatLng());
    });

    map.on('dragstart zoomstart', () => {
      if (followSanta) {
        followSanta = false;
        followBtn.textContent = 'Follow Santa: OFF';
      }
    });

    recenterBtn.addEventListener('click', () => {
      map.panTo(marker.getLatLng());
      followSanta = true;
      followBtn.textContent = 'Follow Santa: ON';
    });

    function animateMarker(from, to, duration = 1000) {
      const start = performance.now();
      function step(now) {
        const t = Math.min(1, (now - start) / duration);
        const lat = from.lat + (to.lat - from.lat) * t;
        const lng = from.lng + (to.lng - from.lng) * t;

        marker.setLatLng([lat, lng]);
        if (followSanta) map.panTo([lat, lng], { animate: false });

        if (t < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    let lastPoint = L.latLng(fallbackCoords.lat, fallbackCoords.lng);
    let backoff = REFRESH_MS;

    async function updateLocation() {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), FETCH_TIMEOUT_MS);

      try {
        const response = await fetch(firebaseURL, { cache: 'no-store', signal: controller.signal });
        clearTimeout(timeout);

        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const raw = await response.json();

        const secretKey = Object.keys(raw)[0];
        const data = raw[secretKey];

        const valid =
          data && typeof data.lat === 'number' &&
          typeof data.lng === 'number' &&
          typeof data.ts === 'string';

        if (!valid) throw new Error('Bad payload');

        const gpsTime = new Date(data.ts).getTime();
        const ageMs = Date.now() - gpsTime;

        if (ageMs < STALE_MS) {
          lastUpdatedEl.style.display = 'inline';
          lastUpdatedEl.textContent = `Last update: ${fmt.format(new Date(gpsTime))}`;

          ageEl.style.display = 'inline';
          ageEl.textContent = `Age: ${Math.floor(ageMs / 1000)}s`;
        } else {
          lastUpdatedEl.style.display = 'none';
          ageEl.style.display = 'none';
        }

        if (ageMs < STALE_MS) {
          const newLatLng = L.latLng(data.lat, data.lng);
          trail.addLatLng(newLatLng);

          animateMarker(lastPoint, newLatLng);
          lastPoint = newLatLng;

          setLive();
          backoff = REFRESH_MS;
          return;
        }

        goFallback('üéÑ GPS inactive ‚Äì fallback to Lapland');

      } catch (e) {
        clearTimeout(timeout);
        console.error("Error:", e);

        goFallback('üéÑ GPS fetch failed ‚Äì fallback to Lapland');
        backoff = Math.min(backoff * 1.5, 60000);

      } finally {
        scheduleNext();
      }
    }

    function goFallback(msg) {
      const next = L.latLng(fallbackCoords.lat, fallbackCoords.lng);
      animateMarker(marker.getLatLng(), next, 600);

      lastUpdatedEl.style.display = 'none';
      ageEl.style.display = 'none';

      setLapland(msg);
    }

    let timer;
    function scheduleNext() {
      clearTimeout(timer);
      timer = setTimeout(updateLocation, backoff);
    }

    setLapland();
    updateLocation();

    const snow = document.getElementById('snow');
    const ctx = snow.getContext('2d');

    function resize() {
      snow.width = window.innerWidth;
      snow.height = window.innerHeight;
    }

    window.addEventListener('resize', resize);
    resize();

    let flakes = Array.from({ length: 120 }, () => ({
      x: Math.random()*snow.width,
      y: Math.random()*snow.height,
      r: Math.random()*2 + 0.8,
      s: Math.random()*0.6 + 0.3,
      a: Math.random()*Math.PI*2
    }));

    (function drawSnow() {
      ctx.clearRect(0,0,snow.width,snow.height);

      for(const f of flakes) {
        f.y += f.s;
        f.x += Math.sin(f.a+=0.01)*0.3;

        if(f.y > snow.height) {
          f.y = -5;
          f.x = Math.random()*snow.width;
        }

        ctx.globalAlpha = 0.9;
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fillStyle = '#fff';
        ctx.fill();
      }

      requestAnimationFrame(drawSnow);
    })();

  </script>

</body>
</html>
